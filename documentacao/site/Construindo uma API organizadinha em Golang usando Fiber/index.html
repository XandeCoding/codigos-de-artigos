
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../Criando%20uma%20API%20de%20p%C3%A1ginas%20est%C3%A1ticas%20b%C3%A1sica%20com%20Deno%20%F0%9F%A6%95/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.14">
    
    
      
        <title>Construindo uma API organizadinha em Golang usando Fiber - Meus textinhos</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#construindo-uma-api-organizadinha-em-golang-usando-fiber" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Meus textinhos" class="md-header__button md-logo" aria-label="Meus textinhos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Meus textinhos
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Construindo uma API organizadinha em Golang usando Fiber
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Meus textinhos" class="md-nav__button md-logo" aria-label="Meus textinhos" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Meus textinhos
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Welcome to MkDocs
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Construindo uma API organizadinha em Golang usando Fiber
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Construindo uma API organizadinha em Golang usando Fiber
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#o-que-essa-api-faz" class="md-nav__link">
    O que essa API faz?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estrutura" class="md-nav__link">
    Estrutura
  </a>
  
    <nav class="md-nav" aria-label="Estrutura">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pronto" class="md-nav__link">
    Pronto
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Criando%20uma%20API%20de%20p%C3%A1ginas%20est%C3%A1ticas%20b%C3%A1sica%20com%20Deno%20%F0%9F%A6%95/" class="md-nav__link">
        Criando uma API de p√°ginas est√°ticas b√°sica com Deno ü¶ï
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../Documenta%C3%A7%C3%A3o%20Autom%C3%A1tica%20usando%20MkDocs%20e%20Python/" class="md-nav__link">
        Documenta√ß√£o Autom√°tica usando MkDocs e Python
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#o-que-essa-api-faz" class="md-nav__link">
    O que essa API faz?
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#estrutura" class="md-nav__link">
    Estrutura
  </a>
  
    <nav class="md-nav" aria-label="Estrutura">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pronto" class="md-nav__link">
    Pronto
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="construindo-uma-api-organizadinha-em-golang-usando-fiber">Construindo uma API organizadinha em Golang usando Fiber</h1>
<p>Nos √∫ltimos tempo brincando com go e apanhando bastante com o sistema de packages dele (aqui cabe um mea-culpa porque √© um esquema bem legal se bem utilizado) me peguei pensando bastante em qual seria a melhor forma de organizar a API que estava fazendo de estudo.</p>
<p>Acabei pegando bastantes exemplos inclusive do reposit√≥rio do <a href="https://github.com/gofiber/recipes">Fiber</a> e cheguei em um formato que acredito que seja bem leg√≠vel e f√°cil de adicionar novas funcionalidades.</p>
<p><code>**Disclaimer.:** N√£o estou dizendo que esta √© a melhor forma de se organizar uma API em GoLang mas foi uma que me atendeu e acho que tamb√©m pode atender em muitos casos onde uma API gen√©rica √© necess√°ria.</code></p>
<h2 id="o-que-essa-api-faz">O que essa API faz?</h2>
<p>**<a href="https://github.com/XandeCoding/codigos-de-artigos/tree/api/go-simple-api/golang/api_simples">Link do reposit√≥rio</a></p>
<p>Bem essa API foi feita para salvar informa√ß√µes sobre livros e tem somente 3 endpoints:</p>
<p><strong>GET:</strong> Retorna informa√ß√µes sobre um livro</p>
<p><strong>PUT:</strong> Adiciona ou altera informa√ß√µes sobre um livro</p>
<p><strong>DELETE:</strong> Deleta as informa√ß√µes de um livro</p>
<p>Implementei somente o b√°sico mesmo, e para isso usei como framework o Fiber que mencionei logo acima que tem uma pegada bem parecida com Express.js que eu curti bastante, mas com as vantagens de Golang como menor aloca√ß√£o de mem√≥ria e uma velocidade tremenda, e os dados est√£o sendo salvos em um Redis o qual √© poss√≠vel inicializar usando um <a href="https://github.com/XandeCoding/codigos-de-artigos/blob/api/go-simple-api/golang/api_simples/docker-compose.yml">docker-compose</a>.</p>
<h2 id="estrutura">Estrutura</h2>
<pre><code class="language-shell">| api_simples
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ docs
‚îÇ   ‚îî‚îÄ‚îÄ estrutura.png
‚îú‚îÄ‚îÄ go.mod
‚îú‚îÄ‚îÄ go.sum
‚îú‚îÄ‚îÄ main.go
‚îú‚îÄ‚îÄ pkg
‚îÇ   ‚îú‚îÄ‚îÄ configurations
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.go
‚îÇ   ‚îú‚îÄ‚îÄ entities
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ book.go
‚îÇ   ‚îú‚îÄ‚îÄ handlers
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ book_handler.go
‚îÇ   ‚îú‚îÄ‚îÄ repositories
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ book_repository.go
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commons.go
‚îÇ   ‚îî‚îÄ‚îÄ routes
‚îÇ       ‚îú‚îÄ‚îÄ book_router.go
‚îÇ       ‚îî‚îÄ‚îÄ routes.go
‚îî‚îÄ‚îÄ README.md
</code></pre>
<p>Acredito que n√£o fa√ßa muito sentido falar somente o que existe em cada pasta, mas sim dizer o porqu√™ e o contexto do porque foi feito desta forma, n√£o vou seguir a ordem ali de cima, pois acho que √© mais f√°cil explicar n√£o seguindo esta ordem, ent√£o vamos l√°:</p>
<p><strong>go.mod</strong></p>
<pre><code class="language-go">module github.com/XandeCoding/codigos-de-artigos/golang/api_simples

go 1.19

require (
    github.com/go-redis/redis/v9 v9.0.0-beta.2
    github.com/gofiber/fiber/v2 v2.36.0
)
</code></pre>
<p>Este arquivo me ajuda a resolver v√°rias quest√µes do workspace de go, pois posso criar um reposit√≥rio de Go onde eu quiser e isso n√£o me traz um problema, por exemplo, de acessar packages tanto externos quanto locais principalmente locais.</p>
<p>Para criar ele somente realizei o comando <code>go mod init</code> com o caminho do projeto no github como argumento que no caso √© <em>github.com/XandeCoding/codigos-de-artigos/golang/api_simples</em>, n√£o necessariamente √© necess√°rio por o caminho do github pode ser utilizado somente o nome do projeto que aqui √© <em>api_simples</em> por exemplo.</p>
<p>Como √© algo p√∫blico que quero fazer, acho que √© interessante colocar o caminho inteiro do reposit√≥rio, pois caso eu ou outro algu√©m queira usar um arquivo em espec√≠fico do projeto ele pode somente referenciar o caminho e tudo deve funcionar perfeitamente, pois o caminho inteiro dos outros arquivos m√≥dulos est√£o sendo referenciados.</p>
<p><strong>pkg e main.go</strong></p>
<p>A pasta <em>pkg</em> √© a pasta onde vou deixar o c√≥digo da minha API, ent√£o todas as features est√£o implementadas dentro desta pasta e o <em>main.go</em> √© somente um arquivo para inicializar a aplica√ß√£o e n√£o implementa nada, por isso ela fica de fora, e usada somente para realizar o <em>start</em> na API.</p>
<p><code>_main.go:_</code></p>
<pre><code class="language-go">package main

import (
    &quot;github.com/XandeCoding/codigos-de-artigos/golang/api_simples/pkg/routes&quot;
    &quot;github.com/gofiber/fiber/v2&quot;
)

func main() {
    app := fiber.New()
    routes.AddRoutes(app)

    app.Listen(&quot;:3000&quot;)
}
</code></pre>
<p><strong>pkg/configurations</strong></p>
<p>Aqui ficam os arquivos de configura√ß√£o, neste caso temos o arquivo_database.go_ que configura o acesso ao banco, mas caso tiv√©ssemos outras configura√ß√µes de aplica√ß√µes ou de ferramentas que seriam utilizadas por uma ou mais partes da aplica√ß√£o isso ficaria aqui como, por exemplo, uma configura√ß√£o customizada do fiber ou mesmo capturar as vari√°veis de ambiente que √© um caso de uso bem comum.</p>
<p><strong>pkg/entities</strong></p>
<p>Entidades em geral podem ser usadas em v√°rios lugares, principalmente neste caso onde uso tanto para receber o dado no endpoint e fazer o parse quanto nas fun√ß√µes de adicionar o dado no banco. Ent√£o colocar em um lugar comum se torna bastante interessante, √© claro que h√° estruturas onde os packages s√£o separados por features e temos escopos mais fechados, a√≠ talvez n√£o fosse interessante esta abordagem que estou usando aqui.</p>
<p><code>Exemplo da configura√ß√£o de conex√£o com o Redis em _database.go:_</code></p>
<pre><code class="language-go">package configurations

import &quot;github.com/go-redis/redis/v9&quot;

func CreateClient() *redis.Client {
    redisDatabase := redis.NewClient(&amp;redis.Options{
        Addr: &quot;localhost:6379&quot;,
        Password: &quot;&quot;,
        DB: 0,
    })

    return redisDatabase
}
</code></pre>
<p><strong>pkg/repositores</strong></p>
<p>Neste pacote ficam as fun√ß√µes que trabalham diretamente com o banco Redis ent√£o nelas eu recebo o dado de um livro no caso a entidade <em>book</em> e tenho fun√ß√µes que tanto a inserem, atualizam e a deletam do banco. Caso tivesse outra entidade a ser tratada no banco como por exemplo, library_ onde trataria de dados sobre livrarias, ela seria um arquivo separado onde ficariam somente fun√ß√µes relacionadas a estas informa√ß√µes.</p>
<p><code>Fragmento de *book_repository.go:*</code></p>
<pre><code class="language-go">type Repository struct {
    database *redis.Client
}

...

func (rdb Repository) GetBook(name string) string {
    ctx, cancel := getContext()
    defer cancel()
    book, _ := rdb.database.Get(ctx, name).Result()

    return book
}
</code></pre>
<p><strong>pkg/routes</strong></p>
<p>Seguindo o exemplo de outras partes da aplica√ß√£o separei as rotas por arquivos, mesmo que tenhamos um arquivo <em>routes.go</em> que inicializa estas rotas √© interessante deixarmos as rotas de determinado recurso separados, pois facilita a leitura e o entendimento de outras pessoas que possam vir a dar manuten√ß√£o no c√≥digo.</p>
<p><code>Parte em que inicializo as rotas em _routes.go:_</code></p>
<pre><code class="language-go">func AddRoutes(app *fiber.App) *fiber.App {
    bookRouter(app)

    return app
}
</code></pre>
<p>Algo que curti muito √© que em <em>book_router.go</em> somente explicitei as rotas, m√©todos e as fun√ß√µes que s√£o os chamados <em>handlers</em> que est√£o em outra parte da aplica√ß√£o. Outra coisa importante √© que esta estrutura possibilita que criemos inst√¢ncias que podem ser reutilizadas em todos os endpoints deste determinado recurso que no caso foi uma inst√¢ncia de conex√£o com o banco Redis.</p>
<p><code>Fragmento onde explicito os recursos de _book_router:_</code></p>
<pre><code class="language-go">func bookRouter(app *fiber.App) *fiber.App {
    bookRepository := repositories.NewRepository()

    app.Get(&quot;/book/:name&quot;, handlers.GetBookHandler(bookRepository))
    app.Put(&quot;/book&quot;, handlers.SetBookHandler(bookRepository))
    app.Delete(&quot;/book/:name&quot;, handlers.DeleteBookHandler(bookRepository))

    return app
}
</code></pre>
<p><strong>pkg/handlers</strong></p>
<p>Em handlers deixo as fun√ß√µes que v√£o ser chamadas pelos endpoints, por exemplo, o endpoint <code>_PUT: /book_</code> chama a fun√ß√£o <em>SetBookHandler</em> que est√° no arquivo <em>book_handler.go</em> que retorna a fun√ß√£o que vai ser chamada quando este recurso for acessado.</p>
<p><code>C√≥digo da fun√ß√£o _SetBookHandler:_</code></p>
<pre><code class="language-go">func SetBookHandler(bookRepository *repositories.Repository) fiber.Handler {
    return func(c *fiber.Ctx) error {
        book := new(entities.Book)
        err := c.BodyParser(book)

        if err != nil {
            message := map[string]string{&quot;message&quot;: &quot;Invalid entry data&quot;}
            return c.Status(400).JSON(message)
        }

        book_name_normalized := strings.ReplaceAll(
            strings.ToLower(book.Name), &quot; &quot;, &quot;_&quot;,
        )
        key := &quot;book:&quot; + book_name_normalized
        bookRepository.SetBook(key, book)
        return c.Send(c.Body())
    }
}
</code></pre>
<h3 id="pronto">Pronto</h3>
<p>Espero ter ajudado com alguns pontos de dificuldade que quando come√ßamos uma API principalmente em uma linguagem que n√£o temos tanta intimidade que foi o meu caso pode nos deixar um pouco confusos, mas este foi uma estrutura inicial que curti bastante, mas qualquer coment√°rio ou feedback pode comentar que √© sempre bom melhorarmos n√£o √©?, at√© a pr√≥xima :wave:</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>